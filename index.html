<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitcoin Block RNG</title>
  <style>
    :root { --bg:#121212; --card:#1e1e1e; --line:#2a2a2a; --fg:#f0f0f0; --muted:#c9c9c9; --accent:#2a82da; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background:var(--bg); color:var(--fg); }
    header, footer{ background:var(--card); padding:16px; text-align:center; }
    main{ padding:24px; }
    .section{ margin:20px auto; max-width:980px; background:var(--card); border:1px solid var(--line); border-radius:12px; padding:18px; }
    h1,h2,h3,label,p{ color:var(--fg); }
    p.muted, .muted{ color:var(--muted); }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; }
    input, select, textarea{ width:100%; background:#0e0e0e; color:var(--fg); border:1px solid var(--line); border-radius:10px; padding:10px 12px; }
    textarea{ min-height:96px; }
    .button{ background:var(--accent); border:0; color:#fff; padding:10px 14px; border-radius:999px; cursor:pointer; font-weight:700; }
    .button[disabled]{ opacity:.6; cursor:not-allowed; }
    .pill{ background:#0e0e0e; border:1px solid var(--line); padding:6px 10px; border-radius:999px; font-size:12px; color:var(--muted); }
    .mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; }
    .nowrap{ white-space:nowrap; overflow:auto; display:block; }
    .hash-line{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; white-space:nowrap; overflow:auto; margin:4px 0; padding:6px 8px; border:1px solid var(--line); border-radius:8px; background:#0e0e0e; }
    .hidden{ display:none; }
    a{ color:#9ec4ff; text-decoration:none; }
    .ts-label{ display:flex; align-items:center; gap:8px; }
    .ts-label input{ margin-left:8px; vertical-align:middle; }
    .two-col{ display:grid; grid-template-columns:1fr; gap:14px; }
    @media (min-width: 860px){ .two-col{ grid-template-columns:1fr 1fr; } }
    .card-lite{ border:1px solid var(--line); border-radius:10px; padding:12px; background:#0e0e0e; }
    .small{ font-size:12px; color:var(--muted); }
    .donate{ text-align:center; margin-top:20px; }
    .donate img{ max-width:180px; margin-top:10px; }
  </style>
</head>
<body>
  <header>
    <h1>Bitcoin Block RNG</h1>
  </header>

  <main>
    <!-- Landing Page -->
    <section id="landing" class="section">
      <h2>Welcome</h2>
      <p class="muted" style="margin-top:4px;">
        This site gives you random numbers that come straight from Bitcoin block hashes.
        It’s simple to use, easy to understand, and anyone can verify the results.
      </p>

      <div class="card-lite" style="margin-top:12px;">
        <h3 style="margin:0 0 8px;">Why use Bitcoin blocks?</h3>
        <p>
          Every Bitcoin block has a unique fingerprint called a hash. Nobody knows what the hash will be
          until the block is mined, and once it’s published, it can’t be changed. That makes it a fair
          and open way to get random numbers you can trust and verify.
        </p>
        <ul style="margin:0 0 0 18px;">
          <li><strong>Transparent:</strong> You can look up the block hash yourself.</li>
          <li><strong>Verifiable:</strong> We show the blocks and provide a proof anyone can verify.</li>
          <li><strong>Accessible:</strong> No accounts or sign-ups—just click and go.</li>
        </ul>
      </div>

      <div class="card-lite" style="margin-top:12px;">
        <h3 style="margin:0 0 8px;">How to use it</h3>
        <ol style="margin:0 0 0 18px;">
          <li>Click <em>Go to Random Number Generator</em>.</li>
          <li>Pick how many numbers (up to 10) and the range you want (for example, 1–100).</li>
          <li>Choose how many consecutive blocks (1–5). More blocks give extra protection against miner manipulation, but add about 10 minutes of waiting time per additional block.</li>
          <li>(Optional) Turn on a public timestamp to lock in your choices before the block arrives, then press <em>Begin</em>.</li>
          <li>Once the block(s) arrive, your random number(s) will be displayed, along with the hashes and an easy way to share or verify.</li>
        </ol>
      </div>

      <p class="small" style="margin-top:10px;">
        Tip: One block is quick and works well for most uses. If you’d like a little extra peace of mind,
        select more blocks and let the site combine them for you.
      </p>

      <button class="button" id="gotoGenerator" style="margin-top:12px;">Go to Random Number Generator</button>
    </section>

    <!-- Generator Page -->
    <section id="generator" class="section hidden">
      <h2>Random Number Generator</h2>
      <p class="muted">Choose how many random numbers (max <strong>10</strong>), a range, and consecutive blocks (max <strong>5</strong>).</p>

      <div class="grid" style="margin-top:8px;">
        <div>
          <label for="count">How many random numbers</label>
          <input type="number" id="count" min="1" max="10" value="1" />
        </div>
        <div>
          <label for="min">Minimum</label>
          <input type="number" id="min" value="1" />
        </div>
        <div>
          <label for="max">Maximum (≤ 1e12)</label>
          <input type="number" id="max" value="100" />
        </div>
        <div>
          <label for="kblocks">Consecutive blocks (K)</label>
          <input type="number" id="kblocks" min="1" max="5" value="1" />
        </div>
        <div>
          <label for="provider">Data provider</label>
          <select id="provider">
            <option value="mempool">mempool.space (REST)</option>
            <option value="blockstream">blockstream.info (Esplora)</option>
          </select>
        </div>
      </div>

      <!-- Public timestamp area -->
      <div class="row" style="margin-top:12px; align-items:center;">
        <label class="ts-label">Would you like a public timestamp on Nostr?
          <input id="use-commit" type="checkbox" />
        </label>
        <button id="copy-commit" class="button hidden" type="button">Copy Commit String</button>
        <input id="commit-string" class="mono hidden" style="flex:1 1 360px;" readonly placeholder="Commit string will appear here after first Begin (commit phase)" />
        <span id="nostr-links" class="small hidden" style="gap:10px; display:none; align-items:center;">
          <a id="open-snort" href="https://snort.social" target="_blank" rel="noopener">Open Snort</a>
          <span>•</span>
          <a id="search-nostrband" href="#" target="_blank" rel="noopener">Search Nostr.Band</a>
        </span>
      </div>
      <div class="muted" id="commit-hint" style="margin-top:4px; display:none;"></div>

      <!-- Begin / Status line -->
      <div class="row" style="margin-top:14px;">
        <button id="begin" class="button" type="button">Begin</button>
        <button id="stop" class="button" type="button" disabled>Stop</button>
        <span id="tip" class="pill">Block: --</span>
        <span id="eta" class="pill">ETA: --</span>
        <span id="since" class="pill">Since last block: --</span>
      </div>
      <div id="status" class="muted" style="margin-top:8px;"></div>

      <!-- Donation QR -->
      <div class="donate">
        <p>If you appreciate and use this site, consider sending some sats:</p>
        <img src="lnurladdress.png" alt="Lightning Donation QR" />
      </div>
    </section>

    <!-- Results Page -->
    <section id="results" class="section hidden">
      <h2>Results</h2>
      <div id="committedInfo" class="muted" style="margin-bottom:8px;"></div>
      <div id="hashes"></div>
      <div id="numbers" style="margin-top:8px;"></div>

      <h3 style="margin-top:14px;">Verification</h3>
      <div class="two-col">
        <!-- Column A: Share your proof -->
        <div class="card-lite">
          <h4 style="margin:0 0 8px;">Share your proof</h4>
          <p class="muted" style="margin:0 0 10px;">Optional: paste your Nostr note URL so it’s included in the copied proof.</p>
          <div class="row" style="align-items:flex-end; gap:8px;">
            <div style="flex:1 1 320px;">
              <label class="muted" for="note-url">Nostr note URL (optional)</label>
              <input id="note-url" type="url" placeholder="https://snort.social/e/… or https://nostr.band/…" />
            </div>
          </div>
          <div class="row" style="margin-top:10px; gap:8px;">
            <button id="copyShort" class="button" type="button">Copy Short Proof</button>
            <button id="copyLong" class="button" type="button">Copy Long Proof</button>
          </div>
          <p class="muted" style="margin:8px 0 0;">Short proof is social-friendly (≈140 chars). Long proof is fully self-contained.</p>
        </div>

        <!-- Column B: Verify a short proof -->
        <div class="card-lite">
          <h4 style="margin:0 0 8px;">Verify a short proof</h4>
          <p class="muted" style="margin:0 0 10px;">Paste a short proof to check formatting & CRC integrity.</p>
          <div class="row" style="align-items:flex-end; gap:8px;">
            <div style="flex:1 1 320px;">
              <label class="muted" for="verifyShortBox">Short proof</label>
              <input id="verifyShortBox" type="text" placeholder="BBRNG v1|p=mp|t=…|s=…|k=…|r=min-max|n=N|x=[…]|crc=…" />
            </div>
            <button id="verifyBtn" class="button" type="button">Verify</button>
          </div>
          <div id="verifyStatus" class="muted" style="margin-top:6px;"></div>
        </div>
      </div>
      <!-- Fallback copy area (shown only if clipboard API fails) -->
      <div id="copyFallbackWrap" class="section hidden" style="max-width:980px;">
        <h3>Manual copy</h3>
        <p class="muted">Your browser blocked 1-click copy. Select and copy the text below manually (Ctrl/Cmd+C).</p>
        <textarea id="copyFallback" class="mono" readonly></textarea>
      </div>

      <!-- Donation QR -->
      <div class="donate">
        <p>If you appreciate and use this site, consider sending some sats:</p>
        <img src="lnurladdress.png" alt="Lightning Donation QR" />
      </div>
    </section>
  </main>

  <footer>
    <p>© 2025 Bitcoin Block RNG | Contact: <a href="https://snort.social/p/npub177wsn56w3dzvmkut9v0vt9larwckmctuvyvmx8qvqd2ywa6hup7svt2042" target="_blank" rel="noopener">Nostr (npub)</a></p>
    <p>Disclaimer: Do not use for high-stakes selections. No personal data is collected. Report issues at <a href="https://github.com/btcdds/bitcoinblockrng/issues" target="_blank" rel="noopener">GitHub Issues</a>.</p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
